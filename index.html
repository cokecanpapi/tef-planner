<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEF Canada: 365-Day Strategic Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #fcfaf8;
            --text-main: #44403c;
            --bg-card: #ffffff;
            --bg-nav: rgba(255, 255, 255, 0.9);
            --border-color: #e7e5e4;
        }

        body.dark-mode {
            --bg-body: #1c1917;
            --text-main: #e7e5e4;
            --bg-card: #292524;
            --bg-nav: rgba(28, 25, 23, 0.9);
            --border-color: #44403c;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); transition: background-color 0.3s, color 0.3s; }
        .bg-card-theme { background-color: var(--bg-card); transition: background-color 0.3s; }
        .nav-theme { background-color: var(--bg-nav); border-bottom-color: var(--border-color); }
        
        h1, h2, h3, h4 { font-family: 'Playfair Display', serif; }
        
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
            height: 300px; 
            max-height: 400px; 
        }
        
        .active-phase { border-color: #d97706; background-color: #fffbeb; }
        body.dark-mode .active-phase { border-color: #d97706; background-color: #451a03; }
        
        /* Custom scrollbar */
        .day-list::-webkit-scrollbar { width: 8px; }
        .day-list::-webkit-scrollbar-track { background: #f1f1f1; }
        .day-list::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }
        
        .check-btn { transition: all 0.2s; }
        .check-btn:active { transform: scale(0.95); }

        .resource-link { transition: all 0.2s; }
        .resource-link:hover { padding-left: 4px; color: #d97706; }

        .study-btn {
            display: inline-flex;
            align-items: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #d97706;
            margin-top: 0.5rem;
            text-decoration: underline;
            transition: color 0.2s;
        }
        .study-btn:hover { color: #b45309; }

        /* Timer Animation */
        @keyframes pulse-amber {
            0% { box-shadow: 0 0 0 0 rgba(217, 119, 6, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(217, 119, 6, 0); }
            100% { box-shadow: 0 0 0 0 rgba(217, 119, 6, 0); }
        }
        .timer-active {
            animation: pulse-amber 2s infinite;
            background-color: #fffbeb;
            border: 1px solid #f59e0b;
        }
        body.dark-mode .timer-active {
            background-color: #451a03;
            border-color: #d97706;
        }
    </style>
</head>
<body class="antialiased selection:bg-amber-200 selection:text-amber-900">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 nav-theme backdrop-blur-md border-b shadow-sm transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-4">
                    <span class="text-2xl font-bold text-amber-700 font-serif">TEF Master</span>
                    <!-- Lang Toggle -->
                    <button onclick="toggleLang()" class="px-3 py-1 bg-stone-100 hover:bg-stone-200 dark:bg-stone-800 dark:hover:bg-stone-700 rounded-full text-xs font-bold text-stone-600 dark:text-stone-300 transition flex items-center gap-1">
                        <span id="lang-icon">üåê</span> <span id="lang-text">EN</span>
                    </button>
                    <!-- Dark Mode Toggle -->
                    <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 transition">
                        <span id="dark-icon">üåô</span>
                    </button>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="scrollToSection('daily-planner')" class="hover:text-amber-600 font-medium transition" data-i18n="nav_daily">Daily Plan</button>
                    <button onclick="scrollToSection('curriculum')" class="hover:text-amber-600 font-medium transition" data-i18n="nav_roadmap">Curriculum</button>
                    <button onclick="scrollToSection('tools')" class="hover:text-amber-600 font-medium transition" data-i18n="nav_tools">Tools</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-stone-100 dark:bg-stone-900 overflow-hidden transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
            <div class="text-center max-w-3xl mx-auto">
                <span class="inline-block py-1 px-3 rounded-full bg-amber-100 text-amber-800 text-sm font-semibold mb-4 tracking-wide" data-i18n="hero_badge">GOAL: CLB 7 / B2</span>
                <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight" data-i18n="hero_title">
                    Zero to Bilingual in <span class="text-amber-600">365 Days</span>
                </h1>
                <p class="text-lg md:text-xl text-stone-600 dark:text-stone-400 mb-8 leading-relaxed" data-i18n="hero_subtitle">
                    A strategic, week-by-week progressive plan to master French. 
                    <br><span class="text-sm font-medium">No random loops. Real progression.</span>
                </p>
                <button onclick="scrollToSection('daily-planner')" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition transform hover:-translate-y-1" data-i18n="hero_cta">
                    Start Today's Mission
                </button>
            </div>
        </div>
    </header>

    <!-- DAILY PLANNER SECTION -->
    <section id="daily-planner" class="py-16 bg-stone-800 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-amber-500 rounded-full opacity-10 blur-3xl"></div>

        <div class="max-w-5xl mx-auto px-4 relative z-10">
            <div class="text-center mb-10">
                <h2 class="text-3xl md:text-4xl font-bold font-serif mb-4" data-i18n="planner_title">Daily Logbook</h2>
                <p class="text-stone-400" data-i18n="planner_subtitle">Enter day number (1-365) to see your specific Phase curriculum.</p>
            </div>

            <!-- Controls -->
            <div class="bg-stone-900 p-6 rounded-2xl shadow-xl border border-stone-700 max-w-xl mx-auto mb-10">
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <div class="relative w-full">
                        <label for="dayInput" class="block text-xs font-bold text-amber-500 uppercase mb-1" data-i18n="lbl_current_day">Current Day</label>
                        <input type="number" id="dayInput" min="1" max="365" value="1" 
                               class="w-full bg-stone-800 border border-stone-600 text-white text-2xl font-bold py-2 px-4 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none transition"
                               onchange="updateDailyPlan()" onkeyup="updateDailyPlan()">
                    </div>
                    <div class="w-full sm:w-auto mt-5">
                        <button onclick="incrementDay(1)" class="w-full sm:w-auto bg-stone-700 hover:bg-stone-600 text-white font-bold py-3 px-6 rounded-lg transition" data-i18n="btn_next">
                            Next &rarr;
                        </button>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-xs text-stone-400" data-i18n="lbl_progress">Total Progress</span>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-stone-400">üî• Streak: <span id="streakCount" class="text-amber-500 font-bold text-sm">0</span> days</span>
                            <span id="progressText" class="text-xs font-bold text-amber-500">0%</span>
                        </div>
                    </div>
                    <div class="w-full bg-stone-700 rounded-full h-2.5">
                        <div id="progressBar" class="bg-amber-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="text-right mt-1">
                        <span id="completedCount" class="text-xs text-stone-500">0/365 Days Completed</span>
                    </div>
                </div>
            </div>

            <!-- Dynamic Day Card -->
            <div id="day-card" class="bg-white dark:bg-stone-800 text-stone-800 dark:text-stone-200 rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-300 relative">
                <div id="status-ribbon" class="hidden absolute top-0 right-0 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-20">COMPLETED</div>

                <!-- Header -->
                <div class="bg-gradient-to-r from-amber-100 to-white dark:from-stone-700 dark:to-stone-800 p-6 border-b border-stone-200 dark:border-stone-700">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="flex gap-2 mb-2">
                                <span id="day-phase-badge" class="inline-block px-2 py-1 bg-amber-600 text-white text-xs font-bold rounded uppercase tracking-wider">Phase 1</span>
                                <span id="week-badge" class="inline-block px-2 py-1 bg-stone-200 text-stone-600 dark:bg-stone-600 dark:text-stone-300 text-xs font-bold rounded uppercase tracking-wider">Week 1</span>
                            </div>
                            <h3 id="day-title" class="text-2xl md:text-3xl font-bold font-serif">Day 1: Foundation</h3>
                        </div>
                        <div class="text-right">
                            <button id="btn-complete" onclick="toggleCompletion()" class="check-btn flex items-center space-x-2 bg-stone-200 dark:bg-stone-600 hover:bg-green-500 hover:text-white text-stone-600 dark:text-stone-300 font-bold py-2 px-4 rounded-lg shadow transition">
                                <span class="text-xl">‚úì</span>
                                <span id="btn-complete-text" data-i18n="btn_mark_done">Mark Complete</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-0 divide-y md:divide-y-0 md:divide-x divide-stone-100 dark:divide-stone-700">
                    <!-- Task Slots Generator -->
                    <div class="task-slot p-6 hover:bg-stone-50 dark:hover:bg-stone-700 transition flex flex-col justify-between" id="slot-morning"></div>
                    <div class="task-slot p-6 hover:bg-stone-50 dark:hover:bg-stone-700 transition flex flex-col justify-between" id="slot-noon"></div>
                    <div class="task-slot p-6 hover:bg-stone-50 dark:hover:bg-stone-700 transition flex flex-col justify-between" id="slot-pm"></div>
                    <div class="task-slot p-6 hover:bg-stone-50 dark:hover:bg-stone-700 transition flex flex-col justify-between" id="slot-eve"></div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button onclick="toggleCalendar()" class="text-sm text-stone-400 underline hover:text-amber-400 transition" data-i18n="btn_full_cal">View Full 365-Day List</button>
            </div>
            
            <div id="full-calendar" class="hidden mt-6 bg-white dark:bg-stone-800 text-stone-800 dark:text-stone-300 rounded-xl p-6 shadow-xl h-96 overflow-y-auto day-list">
                <h3 class="font-bold text-xl mb-4 sticky top-0 bg-white dark:bg-stone-800 pb-2 border-b border-stone-200 dark:border-stone-700" data-i18n="cal_title">Generated Calendar</h3>
                <div id="calendar-list" class="space-y-2"></div>
            </div>
        </div>
    </section>

    <!-- NEW TOOLS SECTION -->
    <section id="tools" class="py-16 bg-card-theme border-t border-stone-200 dark:border-stone-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold mb-10 text-center" data-i18n="tools_title">Interactive Study Tools</h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
                <!-- Speaking Generator -->
                <div class="bg-stone-50 dark:bg-stone-800 p-8 rounded-xl shadow-sm border border-stone-100 dark:border-stone-700">
                    <h3 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">
                        <span>üó£Ô∏è</span> <span data-i18n="tool_speak_title">Speaking Prompt Generator</span>
                    </h3>
                    <div class="flex gap-4 mb-6">
                        <button onclick="genPrompt('A')" class="flex-1 py-2 bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 rounded font-semibold transition">Task A</button>
                        <button onclick="genPrompt('B')" class="flex-1 py-2 bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 rounded font-semibold transition">Task B</button>
                    </div>
                    <div id="prompt-display" class="p-4 bg-white dark:bg-stone-900 rounded-lg border border-stone-200 dark:border-stone-700 min-h-[100px] flex items-center justify-center text-center text-stone-600 dark:text-stone-400 italic">
                        Select a task type...
                    </div>
                </div>

                <!-- Text to Speech -->
                <div class="bg-stone-50 dark:bg-stone-800 p-8 rounded-xl shadow-sm border border-stone-100 dark:border-stone-700">
                    <h3 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">
                        <span>üéß</span> <span data-i18n="tool_tts_title">Quebec French Reader</span>
                    </h3>
                    <textarea id="tts-input" class="w-full p-3 rounded border border-stone-300 dark:border-stone-600 dark:bg-stone-900 text-stone-800 dark:text-stone-200 mb-4 h-24 text-sm" placeholder="Enter French text to hear it in a Quebec accent..."></textarea>
                    <button onclick="speakText()" class="w-full py-2 bg-amber-600 hover:bg-amber-700 text-white rounded font-bold transition flex justify-center items-center gap-2">
                        <span data-i18n="btn_speak">üîä Read Aloud</span>
                    </button>
                    <p class="text-xs text-stone-400 mt-2 text-center" id="tts-status"></p>
                </div>

                <!-- CLB Calculator -->
                <div class="bg-stone-50 dark:bg-stone-800 p-8 rounded-xl shadow-sm border border-stone-100 dark:border-stone-700">
                    <h3 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">
                        <span>üìä</span> <span data-i18n="tool_clb_title">CLB Calculator</span>
                    </h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="number" id="calc-co" placeholder="CO Score" class="p-2 rounded border border-stone-300 dark:border-stone-600 dark:bg-stone-900 text-stone-800 dark:text-stone-200">
                        <input type="number" id="calc-ce" placeholder="CE Score" class="p-2 rounded border border-stone-300 dark:border-stone-600 dark:bg-stone-900 text-stone-800 dark:text-stone-200">
                        <input type="number" id="calc-eo" placeholder="EO Score" class="p-2 rounded border border-stone-300 dark:border-stone-600 dark:bg-stone-900 text-stone-800 dark:text-stone-200">
                        <input type="number" id="calc-ee" placeholder="EE Score" class="p-2 rounded border border-stone-300 dark:border-stone-600 dark:bg-stone-900 text-stone-800 dark:text-stone-200">
                    </div>
                    <button onclick="calculateCLB()" class="w-full py-2 bg-amber-600 hover:bg-amber-700 text-white rounded font-bold transition">Calculate</button>
                    <div id="clb-result" class="mt-4 text-center font-bold text-lg hidden">
                        <span id="clb-text"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Score Targets Section (Moved for Flow) -->
    <section id="curriculum" class="py-12 bg-stone-100 dark:bg-stone-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-3xl font-bold mb-4" data-i18n="target_title">The Target: CLB 7</h2>
                    <p class="mb-6 opacity-80" data-i18n="target_desc">
                        For Express Entry immigration, CLB 7 (B2 Level) is the critical threshold.
                    </p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white dark:bg-stone-800 p-3 rounded border-l-4 border-amber-500">
                            <h3 class="font-bold text-sm">Listening (CO)</h3>
                            <p class="text-xs opacity-70">Target: 249‚Äì279</p>
                        </div>
                        <div class="bg-white dark:bg-stone-800 p-3 rounded border-l-4 border-amber-500">
                            <h3 class="font-bold text-sm">Reading (CE)</h3>
                            <p class="text-xs opacity-70">Target: 207‚Äì232</p>
                        </div>
                        <div class="bg-white dark:bg-stone-800 p-3 rounded border-l-4 border-amber-500">
                            <h3 class="font-bold text-sm">Speaking (EO)</h3>
                            <p class="text-xs opacity-70">Target: 310‚Äì348</p>
                        </div>
                        <div class="bg-white dark:bg-stone-800 p-3 rounded border-l-4 border-amber-500">
                            <h3 class="font-bold text-sm">Writing (EE)</h3>
                            <p class="text-xs opacity-70">Target: 310‚Äì348</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white dark:bg-stone-800 p-4 rounded-xl shadow-sm border border-stone-200 dark:border-stone-800">
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="scoreChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Resources Section -->
    <section id="resources" class="py-16 bg-stone-900 text-stone-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-white mb-8 text-center" data-i18n="res_title">Free Study Resources</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Tools -->
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700">
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-stone-600 pb-2">üõ†Ô∏è Tools & Grammar</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="https://www.lawlessfrench.com/" target="_blank" class="resource-link block">Lawless French (Best Grammar)</a></li>
                        <li><a href="https://bescherelle.com/conjugueur.php" target="_blank" class="resource-link block">Bescherelle (Conjugation)</a></li>
                        <li><a href="https://www.wordreference.com/" target="_blank" class="resource-link block">WordReference (Dictionary)</a></li>
                        <li><a href="https://www.linguee.com/" target="_blank" class="resource-link block">Linguee (Translations)</a></li>
                        <li><a href="https://www.deepl.com/" target="_blank" class="resource-link block">DeepL (Translator)</a></li>
                        <li><a href="https://ankiweb.net/" target="_blank" class="resource-link block">Anki (Flashcards)</a></li>
                    </ul>
                </div>
                <!-- Listening -->
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700">
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-stone-600 pb-2">üçÅ Canadian Listening</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="https://mauril.ca/en/" target="_blank" class="resource-link block">Mauril App (CBC/Radio-Canada)</a></li>
                        <li><a href="https://ici.radio-canada.ca/ohdio" target="_blank" class="resource-link block">Radio-Canada Ohdio</a></li>
                        <li><a href="https://ici.tou.tv/" target="_blank" class="resource-link block">ICI Tou.tv (Canadian TV)</a></li>
                        <li><a href="https://www.tv5monde.com/" target="_blank" class="resource-link block">TV5Monde (Global French)</a></li>
                        <li><a href="https://baladoquebec.ca/" target="_blank" class="resource-link block">BaladoQu√©bec (Podcasts)</a></li>
                    </ul>
                </div>
                <!-- Reading -->
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700">
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-stone-600 pb-2">üìñ Reading</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="https://www.lapresse.ca/" target="_blank" class="resource-link block">La Presse (News App)</a></li>
                        <li><a href="https://www.ledevoir.com/" target="_blank" class="resource-link block">Le Devoir (Newspaper)</a></li>
                        <li><a href="https://savoirs.rfi.fr/fr/apprendre-enseigner" target="_blank" class="resource-link block">RFI Savoirs (Easy News)</a></li>
                        <li><a href="https://www.thefrenchexperiment.com/stories" target="_blank" class="resource-link block">French Stories (Beginner)</a></li>
                    </ul>
                </div>
                <!-- YouTube -->
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700">
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-stone-600 pb-2">üì∫ YouTube Channels</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="https://www.youtube.com/@innerFrench" target="_blank" class="resource-link block">InnerFrench (Intermediate)</a></li>
                        <li><a href="https://www.youtube.com/@Mapril" target="_blank" class="resource-link block">Mapril (TEF Specific)</a></li>
                        <li><a href="https://www.youtube.com/@FrancaisAuthentique" target="_blank" class="resource-link block">Fran√ßais Authentique</a></li>
                        <li><a href="https://www.youtube.com/@FrenchSchoolTV" target="_blank" class="resource-link block">French School TV</a></li>
                        <li><a href="https://www.youtube.com/@wanderingfrench" target="_blank" class="resource-link block">Wandering French (Quebec)</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-stone-950 text-stone-600 py-8 text-center text-sm">
        <p>TEF Canada Journey Planner &copy; 2025</p>
        <p class="mt-2 text-stone-700">Progress saved automatically.</p>
        <div class="mt-6 flex justify-center gap-4">
            <button onclick="exportData()" class="px-4 py-2 bg-stone-800 hover:bg-stone-700 text-stone-400 rounded transition border border-stone-700">‚¨áÔ∏è Export</button>
            <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-stone-800 hover:bg-stone-700 text-stone-400 rounded transition border border-stone-700">‚¨ÜÔ∏è Import</button>
            <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
        </div>
    </footer>

    <!-- Audio for Timer -->
    <audio id="timer-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <script>
        // --- CONFIG & STATE ---
        let currentLang = 'en';
        let isDark = false;
        let completedDays = JSON.parse(localStorage.getItem('tef_completed_days')) || [];
        let timers = {};

        // --- TRANSLATION DATA ---
        const i18n = {
            en: {
                nav_goals: "Goals", nav_daily: "Daily Plan", nav_tools: "Tools", nav_resources: "Resources", nav_roadmap: "Curriculum",
                hero_badge: "GOAL: CLB 7 / B2", hero_title: 'Zero to Bilingual in <span class="text-amber-600">365 Days</span>',
                hero_subtitle: 'A strategic day-by-day plan to master French.<br><span class="text-sm font-medium">Track your daily progress below.</span>',
                hero_cta: "Start Today's Mission",
                target_title: "The Target: CLB 7", target_desc: "For Express Entry immigration, CLB 7 (B2 Level) is the critical threshold.",
                planner_title: "Daily Logbook", planner_subtitle: "Enter day number (1-365) to generate your specific action plan.",
                lbl_current_day: "Current Day", btn_next: "Next ‚Üí", lbl_progress: "Total Progress",
                btn_mark_done: "Mark Complete", btn_completed: "Completed",
                cal_title: "Generated Calendar", tools_title: "Interactive Study Tools",
                tool_speak_title: "Speaking Prompt Generator", tool_clb_title: "CLB Calculator", tool_tts_title: "Quebec French Reader",
                res_title: "Free Study Resources",
                slot_morning: "Morning", slot_noon: "Noon", slot_pm: "Afternoon", slot_eve: "Evening",
                cat_structure: "Structure", cat_immersion: "Immersion", cat_input: "Input", cat_output: "Production",
                btn_full_cal: "View Full 365-Day List", start_timer: "‚è±Ô∏è Start 30m", btn_speak: "üîä Read Aloud"
            },
            fr: {
                nav_goals: "Objectifs", nav_daily: "Journalier", nav_tools: "Outils", nav_resources: "Ressources", nav_roadmap: "Programme",
                hero_badge: "OBJECTIF: CLB 7 / B2", hero_title: 'De Z√©ro √† Bilingue en <span class="text-amber-600">365 Jours</span>',
                hero_subtitle: 'Un plan strat√©gique quotidien pour ma√Ætriser le fran√ßais.<br><span class="text-sm font-medium">Suivez votre progression ci-dessous.</span>',
                hero_cta: "Voir ma mission du jour",
                target_title: "La Cible: CLB 7", target_desc: "Pour l'immigration (Entr√©e Express), le niveau CLB 7 est crucial.",
                planner_title: "Journal de Bord", planner_subtitle: "Entrez le num√©ro du jour (1-365) pour g√©n√©rer votre plan d'action.",
                lbl_current_day: "Jour Actuel", btn_next: "Suivant ‚Üí", lbl_progress: "Progression Totale",
                btn_mark_done: "Marquer Termin√©", btn_completed: "Termin√©",
                cal_title: "Calendrier G√©n√©r√©", tools_title: "Outils Interactifs",
                tool_speak_title: "G√©n√©rateur de Sujets Oraux", tool_clb_title: "Calculatrice CLB", tool_tts_title: "Lecteur Qu√©becois",
                res_title: "Ressources Gratuites",
                slot_morning: "Matin", slot_noon: "Midi", slot_pm: "Apr√®s-Midi", slot_eve: "Soir",
                cat_structure: "Structure", cat_immersion: "Vocabulaire", cat_input: "Input Actif", cat_output: "Production",
                btn_full_cal: "Voir calendrier complet", start_timer: "‚è±Ô∏è D√©marrer 30m", btn_speak: "üîä Lire"
            }
        };

        // --- 52-WEEK CURRICULUM DATABASE (The Heart of the System) ---
        // This ensures distinct progression from A0 to B2
        const curriculum = {
            // PHASE 1: FOUNDATION (Weeks 1-12)
            1: { focus: "Intro & Genders", grammar: "Articles (le/la/un/une)", url: "https://www.lawlessfrench.com/grammar/articles/", vocab: "Greetings & Numbers" },
            2: { focus: "Existence", grammar: "Verbs √ätre & Avoir (Present)", url: "https://www.lawlessfrench.com/grammar/etre-and-avoir/", vocab: "Classroom Objects" },
            3: { focus: "Action Basics", grammar: "Regular -ER Verbs", url: "https://www.lawlessfrench.com/grammar/er-verbs/", vocab: "Common Verbs" },
            4: { focus: "Negation", grammar: "Negation (ne...pas)", url: "https://www.lawlessfrench.com/grammar/negation-introduction/", vocab: "Daily Routine" },
            5: { focus: "Questions", grammar: "Asking Questions (Est-ce que)", url: "https://www.lawlessfrench.com/grammar/questions/", vocab: "Question Words" },
            6: { focus: "Descriptions", grammar: "Adjective Agreement", url: "https://www.lawlessfrench.com/grammar/adjectives/", vocab: "Colors & Shapes" },
            7: { focus: "Location", grammar: "Prepositions of Place (√†, en)", url: "https://www.lawlessfrench.com/grammar/prepositions/", vocab: "City & Places" },
            8: { focus: "Possession", grammar: "Possessive Adjectives (mon/ton)", url: "https://www.lawlessfrench.com/grammar/possessive-adjectives/", vocab: "Family Members" },
            9: { focus: "Irregular Verbs 1", grammar: "Verbs -IR (finir, choisir)", url: "https://www.lawlessfrench.com/grammar/ir-verbs/", vocab: "Food & Meals" },
            10: { focus: "Irregular Verbs 2", grammar: "Verbs -RE (vendre, attendre)", url: "https://www.lawlessfrench.com/grammar/re-verbs/", vocab: "Shopping" },
            11: { focus: "Future Plans", grammar: "Near Future (Aller + Inf)", url: "https://www.lawlessfrench.com/grammar/near-future/", vocab: "Time & Dates" },
            12: { focus: "Past Events Intro", grammar: "Pass√© Compos√© (with Avoir)", url: "https://www.lawlessfrench.com/grammar/passe-compose/", vocab: "Weekend Activities" },

            // PHASE 2: INTERMEDIATE BRIDGE (Weeks 13-30)
            13: { focus: "Movement Past", grammar: "Pass√© Compos√© (with √ätre)", url: "https://www.lawlessfrench.com/grammar/auxiliary-verbs/", vocab: "Travel & Transport" },
            14: { focus: "Description Past", grammar: "Imparfait (Introduction)", url: "https://www.lawlessfrench.com/grammar/imparfait/", vocab: "Childhood Memories" },
            15: { focus: "Storytelling", grammar: "Pass√© Compos√© vs Imparfait", url: "https://www.lawlessfrench.com/grammar/passe-compose-vs-imparfait/", vocab: "Story Connectors" },
            16: { focus: "Real Future", grammar: "Simple Future Tense", url: "https://www.lawlessfrench.com/grammar/future/", vocab: "Weather & Forecast" },
            17: { focus: "Object Pronouns 1", grammar: "Direct Object Pronouns (le/la)", url: "https://www.lawlessfrench.com/grammar/direct-objects/", vocab: "Replacing Nouns" },
            18: { focus: "Object Pronouns 2", grammar: "Indirect Object Pronouns (lui/leur)", url: "https://www.lawlessfrench.com/grammar/indirect-objects/", vocab: "Communication Verbs" },
            19: { focus: "Advanced Pronouns", grammar: "Pronouns Y and EN", url: "https://www.lawlessfrench.com/grammar/pronouns-y-en/", vocab: "Food Quantities" },
            20: { focus: "Comparisons", grammar: "Comparatives & Superlatives", url: "https://www.lawlessfrench.com/grammar/comparatives/", vocab: "Shopping & Prices" },
            21: { focus: "Politeness", grammar: "Conditional Present", url: "https://www.lawlessfrench.com/grammar/conditional/", vocab: "Polite Requests" },
            22: { focus: "Hypothesis", grammar: "Si Clauses (First/Second)", url: "https://www.lawlessfrench.com/grammar/si-clauses-first-conditional/", vocab: "Dreams & Wishes" },
            23: { focus: "Reflexive Verbs", grammar: "Pronominal Verbs in Past", url: "https://www.lawlessfrench.com/grammar/pronomial-verbs-passe-compose/", vocab: "Daily Routine Advanced" },
            24: { focus: "Negation Advanced", grammar: "Negation (rien, personne, jamais)", url: "https://www.lawlessfrench.com/grammar/negative-adverbs/", vocab: "Abstract Concepts" },
            25: { focus: "Relative Pronouns 1", grammar: "Qui vs Que", url: "https://www.lawlessfrench.com/grammar/relative-pronouns-que-qui/", vocab: "Defining Objects" },
            26: { focus: "Relative Pronouns 2", grammar: "O√π and Dont", url: "https://www.lawlessfrench.com/grammar/relative-pronoun-dont/", vocab: "Describing Places" },
            27: { focus: "Time Duration", grammar: "Depuis, Pendant, Pour", url: "https://www.lawlessfrench.com/grammar/depuis-vs-il-y-a/", vocab: "History & Biographies" },
            28: { focus: "Demonstratives", grammar: "Demonstrative Pronouns (celui/celle)", url: "https://www.lawlessfrench.com/grammar/demonstrative-pronouns/", vocab: "Choices & Preferences" },
            29: { focus: "Adverbs", grammar: "Adverb Formation & Placement", url: "https://www.lawlessfrench.com/grammar/adverbs/", vocab: "Manner & Frequency" },
            30: { focus: "Bridge to B2", grammar: "Review of All Tenses", url: "https://www.lawlessfrench.com/grammar/verb-tenses/", vocab: "General Review" },

            // PHASE 3: B2 MASTERY (Weeks 31-43)
            31: { focus: "Subjunctive 1", grammar: "Subjunctive (Necessity/Will)", url: "https://www.lawlessfrench.com/grammar/subjunctive/", vocab: "Opinions & Debates" },
            32: { focus: "Subjunctive 2", grammar: "Subjunctive (Emotion/Doubt)", url: "https://www.lawlessfrench.com/grammar/subjunctivisor/", vocab: "Feelings & Emotions" },
            33: { focus: "Subjunctive 3", grammar: "Irregular Subjunctives", url: "https://www.lawlessfrench.com/grammar/subjunctive-conjugations/", vocab: "Formal Letters" },
            34: { focus: "Passive Voice", grammar: "La Voix Passive", url: "https://www.lawlessfrench.com/grammar/passive-voice/", vocab: "News & Events" },
            35: { focus: "Gerund", grammar: "Participle Present & G√©rondif", url: "https://www.lawlessfrench.com/grammar/present-participle/", vocab: "Simultaneous Actions" },
            36: { focus: "Reported Speech", grammar: "Discours Indirect (Past)", url: "https://www.lawlessfrench.com/grammar/indirect-speech/", vocab: "Reporting News" },
            37: { focus: "Connectors 1", grammar: "Cause & Consequence (car, donc)", url: "https://www.lawlessfrench.com/vocabulary/conjunctions/", vocab: "Argumentation" },
            38: { focus: "Connectors 2", grammar: "Opposition & Concession", url: "https://www.lawlessfrench.com/vocabulary/conjunctions/", vocab: "Debate Structures" },
            39: { focus: "Past Conditional", grammar: "Conditionnel Pass√© (Regrets)", url: "https://www.lawlessfrench.com/grammar/conditional-perfect/", vocab: "Hypothetical Past" },
            40: { focus: "Plus-que-parfait", grammar: "Plus-que-parfait (Past Perfect)", url: "https://www.lawlessfrench.com/grammar/plus-que-parfait/", vocab: "Literature Basics" },
            41: { focus: "Pronoun Order", grammar: "Double Pronouns Order", url: "https://www.lawlessfrench.com/grammar/double-pronoun-order/", vocab: "Complex Sentences" },
            42: { focus: "Formal Register", grammar: "Soutenue vs Courant", url: "https://www.lawlessfrench.com/grammar/register/", vocab: "Professional French" },
            43: { focus: "B2 Polish", grammar: "Prepositions after Verbs", url: "https://www.lawlessfrench.com/grammar/verbs-with-prepositions/", vocab: "Nuance & Style" },

            // PHASE 4: SIMULATION (Weeks 44-52)
            44: { focus: "TEF Strategy", grammar: "Error Analysis (Common Mistakes)", url: "https://www.lawlessfrench.com/grammar/common-mistakes/", vocab: "TEF Keywords" },
            45: { focus: "Listening Focus", grammar: "Fast Speech Reduction", url: "https://www.lawlessfrench.com/pronunciation/informal-pronunciation/", vocab: "Radio Vocabulary" },
            46: { focus: "Speaking Focus", grammar: "Argue & Convince Structures", url: "https://www.lawlessfrench.com/vocabulary/opinion/", vocab: "Persuasion" },
            47: { focus: "Reading Focus", grammar: "Skimming Techniques", url: "https://www.lawlessfrench.com/reading/", vocab: "Press Vocabulary" },
            48: { focus: "Writing Focus", grammar: "Formal Letter Structure", url: "https://www.lawlessfrench.com/vocabulary/correspondence/", vocab: "Formal Connectors" },
            49: { focus: "Mock Week 1", grammar: "Review Weak Points", url: "", vocab: "Review" },
            50: { focus: "Mock Week 2", grammar: "Review Weak Points", url: "", vocab: "Review" },
            51: { focus: "Mock Week 3", grammar: "Review Weak Points", url: "", vocab: "Review" },
            52: { focus: "Final Prep", grammar: "Relax & Light Review", url: "", vocab: "Success Mindset" }
        };

        const speakingPrompts = {
            A: [
                "Call a restaurant to book a table for 4 people.",
                "Call a gym to ask about membership prices and opening hours.",
                "Call a landlord to ask about an apartment for rent.",
                "Call a friend to ask for a favor (borrowing a car).",
                "Call a travel agency to ask about a trip to Paris.",
                "Call a library to ask about opening hours.",
                "Call a shop to ask if they have a specific item in stock.",
                "Call a hotel to change your reservation dates."
            ],
            B: [
                "Convince a friend to stop smoking.",
                "Convince a friend to move to Canada with you.",
                "Convince your boss to let you work from home.",
                "Convince a friend to adopt a dog.",
                "Convince your partner to buy a new car.",
                "Convince a friend to go camping instead of a hotel.",
                "Convince a friend to start learning French.",
                "Convince a colleague to join the company sports team."
            ]
        };

        // --- CORE FUNCTIONS ---

        function toggleDarkMode() {
            isDark = !isDark;
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('dark-icon');
            icon.innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        function calculateStreak() {
            if (completedDays.length === 0) return 0;
            const sorted = [...completedDays].sort((a,b) => b-a);
            let streak = 0;
            let current = sorted[0];
            streak = 1;
            for (let i = 1; i < sorted.length; i++) {
                if (sorted[i] === current - 1) {
                    streak++;
                    current = sorted[i];
                } else {
                    break;
                }
            }
            return streak;
        }

        function startTimer(slotId, btnId) {
            const btn = document.getElementById(btnId);
            const slot = document.getElementById(slotId);
            const duration = 30 * 60; 
            let timeLeft = duration;
            
            slot.classList.add('timer-active');
            btn.disabled = true;
            
            const timer = setInterval(() => {
                const min = Math.floor(timeLeft / 60);
                const sec = timeLeft % 60;
                btn.innerText = `${min}:${sec < 10 ? '0'+sec : sec}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    document.getElementById('timer-sound').play();
                    btn.innerText = "‚úÖ Done";
                    slot.classList.remove('timer-active');
                    slot.classList.add('border-green-500', 'border-2');
                }
                timeLeft--;
            }, 1000);
            
            timers[slotId] = timer;
        }

        function genPrompt(type) {
            const list = speakingPrompts[type];
            const random = list[Math.floor(Math.random() * list.length)];
            const display = document.getElementById('prompt-display');
            display.innerText = random;
            display.classList.remove('italic', 'text-stone-400');
            display.classList.add('font-bold', 'text-stone-800', 'dark:text-stone-200');
        }

        function speakText() {
            const text = document.getElementById('tts-input').value;
            if (!text) return;

            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang === 'fr-CA') || voices.find(v => v.lang.includes('fr'));
            
            if (voice) {
                utterance.voice = voice;
                document.getElementById('tts-status').innerText = `Playing with voice: ${voice.name}`;
            } else {
                document.getElementById('tts-status').innerText = "Quebec/French voice not found. Using default.";
            }
            window.speechSynthesis.speak(utterance);
        }

        function calculateCLB() {
            const co = parseInt(document.getElementById('calc-co').value) || 0;
            const ce = parseInt(document.getElementById('calc-ce').value) || 0;
            const eo = parseInt(document.getElementById('calc-eo').value) || 0;
            const ee = parseInt(document.getElementById('calc-ee').value) || 0;
            
            function getLevel(score, type) {
                if (score >= 298 && type === 'co') return 9;
                if (score >= 280 && type === 'co') return 8;
                if (score >= 249 && type === 'co') return 7;
                
                if (score >= 248 && type === 'ce') return 9;
                if (score >= 233 && type === 'ce') return 8;
                if (score >= 207 && type === 'ce') return 7;

                if (score >= 371 && (type === 'eo' || type === 'ee')) return 9;
                if (score >= 349 && (type === 'eo' || type === 'ee')) return 8;
                if (score >= 310 && (type === 'eo' || type === 'ee')) return 7;
                
                return "<7";
            }

            const res = `CO: ${getLevel(co,'co')} | CE: ${getLevel(ce,'ce')} | EO: ${getLevel(eo,'eo')} | EE: ${getLevel(ee,'ee')}`;
            const display = document.getElementById('clb-result');
            document.getElementById('clb-text').innerText = res;
            display.classList.remove('hidden');
        }

        // --- DYNAMIC PLAN GENERATOR ---
        function getDayPlan(day) {
            let phase = 1;
            if (day > 90) phase = 2; if (day > 210) phase = 3; if (day > 300) phase = 4;
            
            // Calculate current week (1-52)
            let week = Math.ceil(day / 7);
            if (week > 52) week = 52;
            
            const weekData = curriculum[week];
            
            // Daily rotation for output tasks
            const outputTasks = [
                "Write 5 simple sentences using today's grammar.",
                "Record yourself describing your day (2 mins).",
                "Read a short text aloud to practice pronunciation.",
                "Write a short email/paragraph on the weekly theme.",
                "Describe a picture related to the weekly theme.",
                "Summarize a short news article (written or oral).",
                "Rest Day or Free Output."
            ];
            const outputTask = outputTasks[(day - 1) % 7];

            // Phase-specific Immersion
            let activeTask = "";
            let activeLink = "";
            if (phase === 1) {
                activeTask = "Slow French Listening (Podcast/YouTube)";
                activeLink = "https://www.youtube.com/results?search_query=french+podcast+beginner";
            } else if (phase === 2) {
                activeTask = "Read News Headlines (La Presse) / Watch Short Series";
                activeLink = "https://www.lapresse.ca/";
            } else if (phase === 3) {
                activeTask = "RFI Journal en fran√ßais facile (Full Episode)";
                activeLink = "https://francaisfacile.rfi.fr/fr/podcasts/journal-en-fran%C3%A7ais-facile/";
            } else {
                activeTask = "Full TEF Simulation (Timed Condition)";
                activeLink = "https://www.youtube.com/results?search_query=tef+canada+blanc";
            }

            // Sunday Special
            if (day % 7 === 0) {
                return {
                    phase, week,
                    title: `Day ${day}: Review & Rest`,
                    grammar: `Review Week ${week}: ${weekData.focus}`,
                    grammarUrl: weekData.url,
                    vocab: `Review: ${weekData.vocab}`,
                    vocabQuery: `french vocabulary ${weekData.vocab}`,
                    active: "Watch a French Movie or TV Show (Relaxed)",
                    activeLink: "https://www.netflix.com/browse/genre/100378",
                    output: "No formal output. Rest."
                };
            }

            return {
                phase, week,
                title: `Day ${day}: ${weekData.focus}`,
                grammar: weekData.grammar,
                grammarUrl: weekData.url,
                vocab: weekData.vocab,
                vocabQuery: `french vocabulary ${weekData.vocab}`,
                active: activeTask,
                activeLink: activeLink,
                output: outputTask
            };
        }

        function renderSlot(id, titleKey, catKey, content, link, isVideo) {
            const container = document.getElementById(id);
            const title = i18n[currentLang][titleKey];
            const cat = i18n[currentLang][catKey];
            const btnText = i18n[currentLang].start_timer;
            
            let html = `
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <h4 class="font-bold text-stone-700 dark:text-stone-300 text-sm">${title}</h4>
                        </div>
                        <span class="text-[10px] font-bold uppercase text-amber-500 bg-amber-50 dark:bg-stone-900 px-2 py-0.5 rounded">${cat}</span>
                    </div>
                    <p class="text-sm font-medium leading-relaxed mb-3">${content}</p>
                    ${link ? `<a href="${link}" target="_blank" class="study-btn">${isVideo ? 'üì∫ Watch' : 'üìñ Study'} &rarr;</a>` : ''}
                </div>
                <button id="btn-${id}" onclick="startTimer('${id}', 'btn-${id}')" class="mt-4 w-full py-1.5 bg-stone-100 dark:bg-stone-600 hover:bg-stone-200 dark:hover:bg-stone-500 rounded text-xs font-bold text-stone-500 dark:text-stone-300 transition">${btnText}</button>
            `;
            container.innerHTML = html;
        }

        function updateDailyPlan() {
            const dayInput = document.getElementById('dayInput');
            let day = parseInt(dayInput.value);
            if (day < 1) day = 1; if (day > 365) day = 365;
            
            const plan = getDayPlan(day);
            
            document.getElementById('day-title').innerText = plan.title;
            document.getElementById('day-phase-badge').innerText = `Phase ${plan.phase}`;
            document.getElementById('week-badge').innerText = `Week ${plan.week}`;
            
            const vUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(plan.vocabQuery)}`;
            
            renderSlot('slot-morning', 'slot_morning', 'cat_structure', plan.grammar, plan.grammarUrl, false);
            renderSlot('slot-noon', 'slot_noon', 'cat_immersion', plan.vocab, vUrl, true);
            renderSlot('slot-pm', 'slot_pm', 'cat_input', plan.active, plan.activeLink, true);
            renderSlot('slot-eve', 'slot_eve', 'cat_output', plan.output, null, false);

            const isDone = completedDays.includes(day);
            const btn = document.getElementById('btn-complete');
            const ribbon = document.getElementById('status-ribbon');
            if(isDone) {
                btn.classList.add('bg-green-500', 'text-white');
                btn.classList.remove('bg-stone-200', 'dark:bg-stone-600', 'text-stone-600');
                document.getElementById('btn-complete-text').innerText = i18n[currentLang].btn_completed;
                ribbon.classList.remove('hidden');
            } else {
                btn.classList.remove('bg-green-500', 'text-white');
                btn.classList.add('bg-stone-200', 'dark:bg-stone-600', 'text-stone-600');
                document.getElementById('btn-complete-text').innerText = i18n[currentLang].btn_mark_done;
                ribbon.classList.add('hidden');
            }
        }

        function toggleCompletion() {
            const day = parseInt(document.getElementById('dayInput').value);
            if (completedDays.includes(day)) {
                completedDays = completedDays.filter(d => d !== day);
            } else {
                completedDays.push(day);
            }
            localStorage.setItem('tef_completed_days', JSON.stringify(completedDays));
            updateStats();
            updateDailyPlan();
        }

        function updateStats() {
            const count = completedDays.length;
            const percent = Math.round((count / 365) * 100);
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressText').innerText = `${percent}%`;
            document.getElementById('completedCount').innerText = `${count}/365 Days`;
            document.getElementById('streakCount').innerText = calculateStreak();
        }

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'fr' : 'en';
            document.getElementById('lang-text').innerText = currentLang.toUpperCase();
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[currentLang][key]) el.innerHTML = i18n[currentLang][key];
            });
            updateDailyPlan();
        }
        
        function incrementDay(val) {
            const el = document.getElementById('dayInput');
            let n = parseInt(el.value) + val;
            if(n<=365) { el.value = n; updateDailyPlan(); }
        }

        function toggleCalendar() {
            const cal = document.getElementById('full-calendar');
            const list = document.getElementById('calendar-list');
            if(cal.classList.contains('hidden')) {
                cal.classList.remove('hidden');
                list.innerHTML = "";
                for(let i=1; i<=365; i++) {
                    const p = getDayPlan(i);
                    const done = completedDays.includes(i);
                    list.innerHTML += `<div onclick="document.getElementById('dayInput').value=${i};updateDailyPlan();document.getElementById('daily-planner').scrollIntoView({behavior:'smooth'})" class="cursor-pointer flex justify-between p-2 border-b border-stone-100 dark:border-stone-700 text-xs ${done ? 'bg-green-50 dark:bg-green-900/20' : ''}"><span>Day ${i}</span><span class="${done?'text-green-500':'text-stone-300'}">${done?'‚úì':'‚óã'}</span></div>`;
                }
            } else {
                cal.classList.add('hidden');
            }
        }
        
        function exportData() {
            const uri = 'data:application/json;charset=utf-8,' + encodeURIComponent(localStorage.getItem('tef_completed_days')||"[]");
            const a = document.createElement('a'); a.href = uri; a.download = 'tef_backup.json'; a.click();
        }
        function importData(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                completedDays = JSON.parse(e.target.result);
                localStorage.setItem('tef_completed_days', JSON.stringify(completedDays));
                updateStats(); updateDailyPlan(); alert("Import Successful!");
            };
            reader.readAsText(input.files[0]);
        }

        function scrollToSection(id) { document.getElementById(id).scrollIntoView({behavior:'smooth'}); }

        document.addEventListener('DOMContentLoaded', () => {
            const ctxScore = document.getElementById('scoreChart').getContext('2d');
            new Chart(ctxScore, { type: 'bar', data: { labels: ['CO', 'CE', 'EO', 'EE'], datasets: [{ label:'Min Score', data: [249, 207, 310, 310], backgroundColor: '#d97706' }] }, options: { maintainAspectRatio: false, plugins: { legend: {display:false} } } });
            updateStats();
            updateDailyPlan();
        });
    </script>
</body>
</html>
